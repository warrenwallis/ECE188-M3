<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="lib/jquery-ui.min.css" />
    <title>TinyType</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script type="module">
      const videoElement = document.getElementsByClassName('input_video')[0];
      const canvasElement = document.getElementsByClassName('output_canvas')[0];
      const canvasCtx = canvasElement.getContext('2d');
      
      let i = 0;
      let maxIter = 100;
          let thumbs = 0,
              index = 0,
              middle = 0,
              ring = 0,
              pinky = 0;
  
      function onResults(results) {
        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.drawImage(
            results.image, 0, 0, canvasElement.width, canvasElement.height);
        if (results.multiHandLandmarks) {
          for (const landmarks of results.multiHandLandmarks) {
            drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS,
                           {color: '#00FF00', lineWidth: 5});
            drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 2});
  
            //console.log('x is',landmarks[0].x);
            //console.log('y is',landmarks[0].y);
            //console.log("thumb to wrist:", Math.hypot(landmarks[0].x - landmarks[4].x, landmarks[0].y - landmarks[4].y));
            //console.log("index to wrist:", Math.hypot(landmarks[0].x - landmarks[8].x, landmarks[0].y - landmarks[8].y));
            //console.log("middle to wrist:", Math.hypot(landmarks[0].x - landmarks[12].x, landmarks[0].y - landmarks[12].y));
            //console.log("ring to wrist:", Math.hypot(landmarks[0].x - landmarks[16].x, landmarks[0].y - landmarks[16].y));
            //console.log("pinky to wrist:", Math.hypot(landmarks[0].x - landmarks[20].x, landmarks[0].y - landmarks[20].y));
            
            thumbs = Math.hypot(landmarks[0].x - landmarks[4].x, landmarks[0].y - landmarks[4].y);
            index = Math.hypot(landmarks[0].x - landmarks[8].x, landmarks[0].y - landmarks[8].y);
            middle = Math.hypot(landmarks[0].x - landmarks[12].x, landmarks[0].y - landmarks[12].y);
            ring = Math.hypot(landmarks[0].x - landmarks[16].x, landmarks[0].y - landmarks[16].y);
            pinky = Math.hypot(landmarks[0].x - landmarks[20].x, landmarks[0].y - landmarks[20].y);
          }
  
          let fingers = [thumbs, index, middle, ring, pinky];
          let averages = [0.228855925713142, 0.33346074055961, 0.322248931844184, 0.300157791079334, 0.256935637326885];
          let on = [false, false, false, false, false];
  
          for (const [index, element] of fingers.entries()) {
              if (element > averages[index])
                  on[index] = true;
          }
  
          if (!on[0] && on[4] && on[3])
              console.log(4);
          else if (on[2] && !on[4])
              console.log(3);
          else if (on[1] && !on[3])
              console.log(2);
          else if (on[0] && on[4])
              console.log(5);
          else if (on[0])
              console.log(1);
          else console.log(0);
        }
        canvasCtx.restore();
      }
      
      const hands = new Hands({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
      }});
      hands.setOptions({
        maxNumHands: 2,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });
      hands.onResults(onResults);
      
      const camera = new Camera(videoElement, {
        onFrame: async () => {
          await hands.send({image: videoElement});
        },
        width: 1280,
        height: 720
      });
      camera.start();
      </script>
  </head>

  <body>
    <h1>ECE 188 M3 Demo!</h1>
    
    <div class="input">
      <input type="text" id="textbox" name="textbox"><br>

      <div class="keyboard">
        <div class="keys">
          <button type="button0" id="button0">Button0</button>
          <button type="button1" id="button1">Button1</button>
          <button type="button2" id="button2">Button2</button>
          <button type="button3" id="button3">Button3</button>  
          <button type="button4" id="button4">Button4</button>
          <canvas id="myCanvas">
          </canvas>
          <button type="button5" id="button5">Button5</button>
          <button class="extra" type="button6" id="button6">SPACE .</button>  
          <button class="extra" type="button7" id="button7">DELETE</button>
        </div>  
      </div>
    </div>

    <div class="container">
      <video class="input_video"></video>
      <canvas class="output_canvas"></canvas>
    </div>
   
    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/jquery-ui.min.js"></script>
    <script type="text/javascript" src="lib/yaml.min.js"></script>
    <script type="text/javascript" src="src/main.js"></script>
    <script type="text/javascript" src="src/gesture_recognizer.js"></script>
   
  </body>
</html>
